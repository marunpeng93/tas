(function(r,f){if(typeof define==='function'&&define.amd){define(function(){return f(r,r.document)})}else if(typeof exports==='object'){module.exports=r.document?f(r,r.document):function(w){return f(w,w.document)}}else{r.tas=f(r,r.document)}}(typeof window!=='undefined'?window:this,function(window,document){return function(n){function t(o){if(e[o])return e[o].exports;var a=e[o]={exports:{},id:o,loaded:!1};return n[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var e={};t.m=n,t.c=e,t.p="",t(0)}([function(n,t,e){n.exports=e(1)},function(n,t,e){var o=e(2),a=e(4),s=e(7),i=e(6),r=e(8),c=e(9),u=e(10),l=function(n,t){if("begin"===n)n=u.do(t);else if(i.isAbort())return;a.add(n)};l.await=function(n,t){"begin"===n&&(n=u.do(t)),n.isAwait=!0,i.setHasAsync(!0),a.add(n)},l.promise=function(n,t){l.await(n,t)},l.next=function(n,t){var e=arguments.length;2===e?s.save2(n,t):1===e?s.save1(arguments[0]):0===e?s.save0():s.saveArray([].slice.call(arguments)),o.next()},l.resolve=function(n,t){s.save2(n,t),o.next()},l.break=function(){c.do()},l.abort=function(){r.do()},l.printFlags=function(){var n=e(3);console.log(n.flag)},l.load=function(){var n=e(11);return n.init(l),n.load([].slice.call(arguments)),l},n.exports=l},function(n,t,e){var o,a,s=e(3),i=(e(4),e(5)),r=e(7),c=e(6),u=e(8),l=e(9),f={exec:function(n,t){var e=s.flag;if(!e.isAwait)for(var o,a,i=f[t?"runFuncWithLayer":"runFunc"];(o=n.shift())&&(a=i(o),!e.isAwait);)if("await"===a||!0===o.isAwait){e.isAwait=!0;break}},execFunc:function(n){var t=s.flag;if(!t.isAwait){"await"!==f.runFuncWithLayer(n)&&!0!==n.isAwait||(t.isAwait=!0)}},runFuncWithLayer:function(n){s.extensions.isLogTreeEnabled&&o.logTree(n.name),s.maxLayer=s.layer,s.layer++;var t=f.runFunc(n,!0);return s.layer>0&&s.layer--,t},runFunc:function(n,t){var e=s.extensions.isForEachEnabled,i=s.extensions.isLogTreeEnabled;!t&&i&&o.logTree(n.name);var c=s.pass,f=c.isHasArgs?n.apply(null,c):n();if(!(e&&n.isTheLastFunc&&n.root.isForEach))return void 0===f?r.save0():Array.isArray(f)?r.save(f):"break"===f?l.do():"abort"===f?u.do():"continue"===f?a.continue():r.save1(f),f;a.loop()},next:function(){var n,t,e=s,o=e.flag,r=e.extensions.isForEachEnabled,u=e.maxLayer;for(o.isAwait=!1;u>=0;){if(e.layer=u,e.units[u]&&e.units[u].length&&f.exec(e.units[u]),void 0!==(t=e.tasks[u]))for(;!o.isAwait&&(n=t.shift());)o.isAwait=!1,"function"==typeof n?f.execFunc(n):r&&!0===n.isForEach?a.exec(n):i.do(n);u--}e.tasks[0].length||c.setIsAwait(!1)},saveTas:function(n){o=n},saveForEach:function(n){a=n}};n.exports.__proto__=f},function(n,t){var e={layer:0,maxLayer:0,tasks:{},units:{},pass:[],flag:{hasAsync:!1,isAwait:!1,isAbort:!1},extensions:{isPromiseAllEnabled:!1,isPromiseRaceEnabled:!1,isForEachEnaboed:!1,isLogTreeEnabled:!1},currentTask:{layer:0,root:null}};n.exports.__proto__=e},function(n,t,e){var o=e(3),a=e(2),s=e(5),i=(e(6),{add:function(n){var t=o,e=t.flag,i=typeof n;"function"!==i||t.layer||e.isAwait?("object"===i&&!n.isTheLastFunctionMarked&&this.markTheLastFunction(n),this.addToLayer(n),!e.isAwait&&s.do(t.tasks[t.layer].shift())):a.execFunc(n)},addToLayer:function(n){var t=o,e=t.layer,a=t.tasks;n.layer=e,void 0===a[e]&&(a[e]=[]),a[e].push(n)},markTheLastFunction:function(n){for(var t,e=Object.keys(n),o=e.length-1;o>=0&&"function"!=typeof(t=n[e[o]]);o--);t.isTheLastFunc=!0,n.isTheLastFunctionMarked=!0},clearTheRemainingTasks:function(){var n,t,e=o,a=e.maxLayer;for(t=a;t>=0;t--)e.units[t]&&(e.units[t].length=0);for(t=a;t>0;t--)e.tasks[t]&&(e.tasks[t].length=0);for(n=e.tasks[0];n&&n.length&&!n[0].isFirst;)n.shift()}});n.exports.__proto__=i},function(n,t,e){var o=e(3),a=e(2),s={do:function(n){this.add(n);var t=o.units[n.layer];t&&t.length&&a.exec(t,!0)},add:function(n){var t=o,e=n.layer||0;t.currentTask.layer=e,t.currentTask.root=n,void 0===t.units[e]&&(t.units[e]=[]),this.getAllFunctions(e,n,n,n.isAwait,t.units[e])},getAllFunctions:function n(t,e,a,s,i){for(var r,c,u=Object.keys(a),l=o.extensions.isLogTreeEnabled,f=0,p=u.length;f<p;f++)r=u[f],c=a[r],"object"==typeof c?n(t,e,c,s,i):"function"==typeof c&&(c.root=e,c.layer=t,c.isAwait=s,l&&!c.name&&(c.name=r),i.push(c))},clearTheRemainingFunctions:function(){for(var n=o,t=n.currentTask.layer,e=n.currentTask.root,a=n.units[t],s=0,i=a.length;s<i;s++)a[s].root===e&&a.shift()}};n.exports.__proto__=s},function(n,t,e){var o=e(3),a={isAbort:function(){return o.flag.isAbort},setIsAbort:function(n){o.flag.isAbort=n},setIsAwait:function(n){o.flag.isAwait=n},setHasAsync:function(n){o.flag.hasAsync=n}};n.exports.__proto__=a},function(n,t,e){var o=e(3),a={save:function(n){var t=n.length;2===t?this.save2(n[0],n[1]):1===t?this.save1(n[0]):0===t?this.save0():this.saveArray(n)},save0:function(){var n=o;n.pass[0]=void 0,n.pass[1]=void 0,n.pass.isHasArgs=!1},save1:function(n){var t=o;t.pass[0]=n,t.pass[1]=void 0,t.pass.isHasArgs=!0},save2:function(n,t){var e=o;e.pass[0]=n,e.pass[1]=t,e.pass.isHasArgs=!0},saveArray:function(n){var t=o;t.pass=n,t.pass.isHasArgs=!0},reset:function(){o.pass.length=0,o.pass.isHasArgs=!1}};n.exports.__proto__=a},function(n,t,e){var o=e(4),a=e(7),s=e(2),i=e(6),r={do:function(){o.clearTheRemainingTasks(),a.reset(),s.next(),i.setIsAbort(!0)}};n.exports.__proto__=r},function(n,t,e){var o=e(5),a={do:function(){o.clearTheRemainingFunctions()}};n.exports.__proto__=a},function(n,t,e){var o=e(6),a={do:function(n){return n.isFirst=!0,o.setIsAbort(!1),n}};n.exports=a},function(n,t,e){var o,a={init:function(n){o=n},load:function(n){1===n.length?a.loadExtension(n[0]):a.loadExtensions(n)},loadExtensions:function(n){n.forEach(function(n){a.loadExtension(n)})},loadExtension:function(n){e(12)("./"+n).init(o)}};n.exports.__proto__=a},function(n,t,e){function o(n){return e(a(n))}function a(n){return s[n]||function(){throw new Error("Cannot find module '"+n+"'.")}()}var s={"./forEach":13,"./forEach.js":13,"./loader":11,"./loader.js":11,"./promise-all":14,"./promise-all.js":14,"./promise-race":16,"./promise-race.js":16,"./promise~util":15,"./promise~util.js":15,"./tree":17,"./tree.js":17};o.keys=function(){return Object.keys(s)},o.resolve=a,n.exports=o,o.id=12},function(n,t,e){var o,a,s,i=e(3),r=e(2),c=e(4),u=e(5),l=e(7),f=0,p={init:function(n){o=n,r.saveForEach(this),i.extensions.isForEachEnabled=!0,o.forEach=this.forEach,o.continue=this.continue},forEach:function(n){n.isForEach=!0,c.markTheLastFunction(n),i.flag.isAwait?c.add(n):p.exec(n)},exec:function(n){a=i.pass[0].slice(),s=n,f=0,p.loop()},loop:function(){for(var n=i,t=n.flag;!t.isAwait&&a.length;)n.layer++,l.save2(a.shift(),f++),c.add(s),n.layer--},continue:function(){u.clearTheRemainingFunctions(),p.loop()}};n.exports.__proto__=p},function(n,t,e){var o,a=e(15),s={init:function(n){o=n,o.all=this.all},all:function(n,t){var e="begin"===n;"begin"===n&&(n=t);var s=Object.keys(n).length,i=0,r=[],c={done:function(n,t){i++,r.push(t),(n||i===s)&&o.resolve(n,r)},abort:function(){o.abort(),this.done("abort")}};n=a.convert(n,c),o.await.apply(null,e?["begin",n]:[n])}};n.exports.__proto__=s},function(n,t){var e={convert:function(n,t){return function(){for(var e=Object.keys(n),o=0;o<e.length;o++)n[e[o]].call(t)}}};n.exports.__proto__=e},function(n,t,e){var o,a=e(6),s=e(15),i={init:function(n){o=n,o.race=this.race,o.cancel=this.cancel},race:function(n,t){var e="begin"===n;"begin"===n&&(n=t);var i=0,r={done:function(n,t){1==++i&&o.resolve(n,t)},abort:function(){a.setIsAwait(!1),o.abort()}};n=s.convert(n,r),o.await.apply(null,e?["begin",n]:[n])},cancel:function(n){n&&n instanceof Array&&n.forEach(function(n){n.abort?"undefined"!=typeof XMLHttpRequest&&n instanceof XMLHttpRequest?n.readyState!==XMLHttpRequest.UNSENT&&n.abort():n.abort():clearTimeout(n)})}};n.exports.__proto__=i},function(n,t,e){var o,a=e(3),s=e(2),i=!0,r={init:function(n){o=n,s.saveTas(o),o.logTree=this.logTree,o.enableLogTree=this.setIsEnabled,o.setIsShowLogTree=this.setIsShowLogTree},setIsEnabled:function(n){a.extensions.isLogTreeEnabled=n},setIsShowLogTree:function(n){i=n},logTree:function(n){if(a.extensions.isLogTreeEnabled){var t=a.layer+1,e=a.maxLayer+1,o=a.flag.isAwait?e+1:t,s=c.repeat(" ",4*(o-1));c.log(("  "+o).substr(-2)+"| "+s+n)}}},c={log:function(){var n=[].slice.call(arguments);i&&console.log.apply(console,n)},repeat:function(n,t){return new Array(t+1).join(n)}};n.exports.__proto__=r}]);}));